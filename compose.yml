services:
  claude-proxy:
    image: nezhar/claude-proxy:${CLAUDE_CONTAINER_VERSION:-latest}
    build:
      context: ./claude-proxy
      dockerfile: Dockerfile
    ports:
      - "8080:8080"
    volumes:
      - claude-telemetry:/data
    environment:
      TARGET_API_URL: https://api.anthropic.com

  claude-datasette:
    image: nezhar/claude-datasette:${CLAUDE_CONTAINER_VERSION:-latest}
    build:
      context: ./claude-datasette
      dockerfile: Dockerfile
    ports:
      - "8001:8001"
    volumes:
      - claude-telemetry:/data:ro
    depends_on:
      - claude-proxy

  claude-code:
    image: jade/claude-code:${CLAUDE_CONTAINER_VERSION:-latest}
    build:
      context: ./claude-code
      dockerfile: Dockerfile
    volumes:
      - ./workspace:/workspace
      - ~/.claude:/home/node/.claude
      - ./.env:/app/.env:ro
    environment:
      CLAUDE_CONFIG_DIR: /home/node/.claude
      ANTHROPIC_BASE_URL: http://claude-proxy:8080
    depends_on:
      - claude-proxy

volumes:
  claude-telemetry:
